GAS LISTING task3.S 			page 1


   1              	/*
   2              	 * ÐŸÑ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ð° Ð²Ð²Ð¾Ð´Ð° ÐºÐ¾Ð´Ð¾Ð² Ñ†Ð¸Ñ„Ñ€Ð¾Ð²Ñ‹Ñ… ÑÐ¸Ð¼Ð²Ð¾Ð»Ð¾Ð² Ð² Ð±ÑƒÑ„ÐµÑ€ Ð² ÐžÐŸ
   3              	 */
   4              	
   5              	/*
   6              	 * ÐÑÑÐµÐ¼Ð±Ð»Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ: as -ahlsm=task3.lst --32 -gstabs+ -o task3.o task3.S
   7              	 * Ð ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ ÑÐ²ÑÐ·ÐµÐ¹: ld -melf_i386 -o task3-exe-S task3.o
   8              	 * Ð—Ð°Ð¿ÑƒÑÐº Ð¾Ñ‚Ð»Ð°Ð´Ñ‡Ð¸ÐºÐ°: kdbg task3-exe-S
   9              	*/
  10              		
  11              	.include "my-macro"
   1              	/*
   2              	 * ÐœÐ°ÐºÑ€Ð¾Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ðµ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¸Ñ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹.
   3              	 * ÐÑ€Ð³ÑƒÐ¼ÐµÐ½Ñ‚Ñ‹:
   4              	 *     - ÐºÐ¾Ð´ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¸Ñ Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ñ‹
   5              	 *
   6              	 * ÐŸÐ¾ÑÐ»Ðµ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ Ð¼Ð°ÐºÑ€Ð¾Ð²Ñ‹Ð·Ð¾Ð²Ð° Ð¸Ð·Ð¼ÐµÐ½ÑÑŽÑ‚ÑÑ Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ñ‹: %e
   7              	 * Ð¡Ð¼. Ñ‚Ð°ÐºÐ¶Ðµ 'man 2 exit'
   8              	*/
   9              	.macro Exit ret_val
  10              	    movl $1, %eax		# Ð½Ð¾Ð¼ÐµÑ€ ÑÐ¸ÑÑ‚. Ð²Ñ‹Ð·Ð¾Ð²Ð° exit
  11              	    movl \ret_val, %ebx     	# ÐºÐ¾Ð´ Ð²Ñ‹Ñ…Ð¾Ð´Ð°
  12              	    int $0x80         		# Ð²Ñ‹Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÑŒ ÑÐ¸ÑÑ‚ÐµÐ¼Ð½Ñ‹Ð¹ Ð²Ñ‹Ð·Ð¾Ð²
  13              	.endm
  14              	
  15              	
  16              	/*
  17              	 * ÐœÐ°ÐºÑ€Ð¾Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ðµ Ð´Ð»Ñ ÑÑ‡Ð¸Ñ‚Ñ‹Ð²Ð°Ð½Ð¸Ñ Ð¾Ð´Ð½Ð¾Ð³Ð¾ Ð±Ð°Ð¹Ñ‚Ð° ÐºÐ¾Ð´Ð° Ñ
  18              	 * ÑÑ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ð½Ð¾Ð³Ð¾ Ð²Ð²Ð¾Ð´Ð°
  19              	 * ÐÑ€Ð³ÑƒÐ¼ÐµÐ½Ñ‚Ñ‹:
  20              	 *     - Ð°Ð´Ñ€ÐµÑ Ð±ÑƒÑ„ÐµÑ€Ð° Ð´Ð»Ñ ÑÑ‡Ð¸Ñ‚Ñ‹Ð²Ð°Ð½Ð¸Ñ Ð±Ð°Ð¹Ñ‚Ð°
  21              	 * Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚:
  22              	 *    - Ð² %eax ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ ÑÑ‡Ð¸Ñ‚Ð°Ð½Ð½Ñ‹Ñ… Ð±Ð°Ð¹Ñ‚Ð¾Ð²
  23              	 *    - Ð¿Ð¾ Ð°Ð´Ñ€ÐµÑÑƒ buf_addr - ÑÑ‡Ð¸Ñ‚Ð°Ð½Ð½Ñ‹Ð¹ Ð±Ð°Ð¹Ñ‚
  24              	 *
  25              	 * ÐŸÐ¾ÑÐ»Ðµ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ Ð¼Ð°ÐºÑ€Ð¾Ð²Ñ‹Ð·Ð¾Ð²Ð° Ð¸Ð·Ð¼ÐµÐ½ÑÑŽÑ‚ÑÑ Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ñ‹: %e
  26              	 * Ð¡Ð¼. Ñ‚Ð°ÐºÐ¶Ðµ 'man 2 read'
  27              	*/
  28              	.macro Getchar buf_addr
  29              	    movl $3, %eax		# Ð½Ð¾Ð¼ÐµÑ€ ÑÐ¸ÑÑ‚. Ð²Ñ‹Ð·Ð¾Ð²Ð° read
  30              	    movl $0, %ebx        	# Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€ 1: Ð´ÐµÑÐºÑ€Ð¸Ð¿Ñ‚Ð¾Ñ€ ÑÑ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ð½Ð¾Ð³Ð¾ Ð²Ð²Ð
  31              	    movl \buf_addr, %ecx    	# Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€ 2: Ð°Ð´Ñ€ÐµÑ Ð±ÑƒÑ„ÐµÑ€Ð° (Ð¾Ð½ Ð¶Ðµ - Ñ„Ð°ÐºÑ‚Ð¸Ñ
  32              	                     		# Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€ Ð¼Ð°ÐºÑ€Ð¾Ð²Ñ‹Ð·Ð¾Ð²Ð°)
  33              	    movl $1, %edx        	# Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€ 3: ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ð±Ð°Ð¹Ñ‚Ð¾Ð² Ð´Ð»Ñ Ñ‡Ñ‚ÐµÐ½Ð¸
  34              	    int $0x80        		# Ð²Ñ‹Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÑŒ ÑÐ¸ÑÑ‚ÐµÐ¼Ð½Ñ‹Ð¹ Ð²Ñ‹Ð·Ð¾Ð²
  35              	.endm
  36              	
  37              	
  38              	/*
  39              	 * ÐœÐ°ÐºÑ€Ð¾Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ðµ Ð´Ð»Ñ  Ð²Ñ‹Ð²Ð¾Ð´Ð° ÑÑ‚Ñ€Ð¾ÐºÐ¸ Ð² Ñ„Ð°Ð¹Ð» ÑÑ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ð
  40              	 * ÐÑ€Ð³ÑƒÐ¼ÐµÐ½Ñ‚Ñ‹:
  41              	 *     - Ð¡Ñ‚Ñ€Ð¾ÐºÐ° Ð´Ð»Ñ Ð²Ñ‹Ð²Ð¾Ð´Ð°.
  42              	 *
  43              	 * ÐŸÑ€Ð¸Ð¼ÐµÑ‚Ñ€ Ð¼Ð°ÐºÑ€Ð¾Ð²Ñ‹Ð·Ð¾Ð²Ð°:
  44              	 *    Puts "Ð¢ÐµÐºÑÑ‚ Ð²Ñ‹Ð²Ð¾Ð´Ð¸Ð¼Ð¾Ð¹ ÑÑ‚Ñ€Ð¾ÐºÐ¸"
  45              	 *
  46              	 * Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚:
GAS LISTING task3.S 			page 2


  47              	 *    - Ð²Ñ‹Ð²Ð¾Ð´Ð¸Ñ‚ Ð² ÑÑ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ð½Ñ‹Ð¹ Ð²Ñ‹Ð²Ð¾Ð´ ÑÐ¸Ð¼Ð²Ð¾Ð»Ñ‹ Ð·Ð°Ð´Ð°Ð½Ð½Ð¾Ð¹ ÑÑ‚Ñ€Ð
  48              	 *      Ð¸ Ð²ÑÐ»ÐµÐ´ Ð·Ð° Ð½Ð¸Ð¼Ð¸ ÑÐ¸Ð¼Ð²Ð¾Ð» Ð¿ÐµÑ€ÐµÐ²Ð¾Ð´Ð° ÑÑ‚Ñ€Ð¾ÐºÐ¸ \n
  49              	 *
  50              	 * ÐŸÐ¾ÑÐ»Ðµ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ Ð¼Ð°ÐºÑ€Ð¾Ð²Ñ‹Ð·Ð¾Ð²Ð° Ð¸Ð·Ð¼ÐµÐ½ÑÑŽÑ‚ÑÑ Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ñ‹: %e
  51              	 * Ð¡Ð¼. Ñ‚Ð°ÐºÐ¶Ðµ 'man puts', 'man 2 write'
  52              	*/
  53              	.macro Puts string
  54              	.data
  55              	    str\@:     .ascii "\string\n"	# Ñ„Ð¾Ñ€Ð¼Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ñ„Ð°ÐºÑ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ð¹ ÑÑ‚Ñ€Ð¾ÐºÐ¸ Ð´
  56              	    strlen\@ =     . - str\@           	# Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ðµ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ñ Ð´Ð»Ð¸Ð½Ñ‹ ÑÑ‚Ñ€Ð¾Ðº
  57              	
  58              	.text
  59              	    movl $4, %eax		# Ð½Ð¾Ð¼ÐµÑ€ ÑÐ¸ÑÑ‚. Ð²Ñ‹Ð·Ð¾Ð²Ð° write
  60              	    movl $1, %ebx		# Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€ 1: Ð´ÐµÑÐºÑ€Ð¸Ð¿Ñ‚Ð¾Ñ€ ÑÑ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ð½Ð¾Ð³Ð¾ Ð²Ñ‹Ð²Ð¾Ð´Ð°
  61              	    movl $str\@, %ecx    	# Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€ 2: Ð°Ð´Ñ€ÐµÑ Ð¿Ð°Ð¼ÑÑ‚Ð¸ Ñ Ð²Ñ‹Ð²Ð¾Ð´Ð¸Ð¼Ñ‹Ð¼Ð¸ ÑÐ
  62              	    movl $strlen\@, %edx     	# Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€ 3: ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ð±Ð°Ð¹Ñ‚Ð¾Ð² Ð´Ð»Ñ Ð²Ñ‹Ð²
  63              	    int $0x80        		# Ð²Ñ‹Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÑŒ ÑÐ¸ÑÑ‚ÐµÐ¼Ð½Ñ‹Ð¹ Ð²Ñ‹Ð·Ð¾Ð²
  64              	.endm...
  12              	
  13              	.bss
  14              	    .lcomm buf, 100			# 100 Ð±Ð°Ð¹Ñ‚Ð¾Ð²Ñ‹Ð¹ Ð±ÑƒÑ„ÐµÑ€ Ð´Ð»Ñ ÐºÐ¾Ð´Ð¾Ð² Ð¿Ñ€Ð¾Ñ‡Ð¸Ñ‚Ð°Ð½Ð½Ñ‹Ñ… Ñ
  15              	    .lcomm c, 1    			# Ð¾Ð´Ð½Ð¾Ð±Ð°Ð¹Ñ‚Ð¾Ð²Ñ‹Ð¹ Ð±ÑƒÑ„ÐµÑ€ Ð´Ð»Ñ Ñ‡Ñ‚ÐµÐ½Ð¸Ñ Ð±Ð°Ð¹Ñ‚Ð° Ð¸Ð· Ñ„Ð
  16              	
  17              	/* 
  18              	 * bss Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ Ð´Ð»Ñ Ð¡ÐµÐºÑ†Ð¸Ñ bss Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ Ð´Ð»Ñ Ñ…Ñ€Ð°Ð½ÐµÐ
  19              	 * ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ñ… Ð¿Ñ€Ð¸ Ð·Ð°Ð¿ÑƒÑÐºÐµ Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ñ‹ Ð¸Ð¼ÐµÑŽÑ‚ Ð½ÑƒÐ»ÐµÐ²Ñ‹Ðµ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸
  20              	 * Ð¸ Ð¸ÑÐ¿Ð¾Ð»Ð½ÑÐµÐ¼Ð¾Ð¼ Ñ„Ð°Ð¹Ð»Ð°Ñ…, Ð¿Ð°Ð¼ÑÑ‚ÑŒ Ð´Ð»Ñ Ð½ÐµÑ‘ Ñ€Ð°ÑÐ¿Ñ€ÐµÐ´ÐµÐ»ÑÐµÑ‚ Ð·Ð°
  21              	 * Ð² ÑÐµÐºÑ†Ð¸Ð¸ bss Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÑÑŽÑ‚ÑÑ Ð´Ð¸Ñ€ÐµÐºÑ‚Ð¸Ð²Ð¾Ð¹ .lcomm, Ð·Ð°Ð´Ð°ÑŽÑ‰ÐµÐ¹ Ð¸Ð¼Ñ
  22              	 * Ð±Ð°Ð¹Ñ‚Ð°Ñ….
  23              	*/
  24              		
  25              	.text
  26              	.global _start
  27              	
  28              	_start:
  29 0000 29F6     	    sub    %esi, %esi     		# ÑƒÐºÐ°Ð·Ð°Ñ‚ÐµÐ»ÑŒ Ð°Ð´Ñ€ÐµÑÐ° Ð±Ð°Ð¹Ñ‚Ð° Ð² Ð±ÑƒÑ„ÐµÑ€Ðµ buf (Ð¸Ð½Ð
  30              	
  31              	show_prompt:
  32              	    Puts "Ð’Ð²Ð¾Ð´Ð¸Ñ‚Ðµ Ñ†Ð¸Ñ„Ñ€Ñƒ, Ð´Ñ€ÑƒÐ³ Ð¼Ð¾Ð¹!"	# Ð¼Ð°ÐºÑ€Ð¾Ð²Ñ‹Ð·Ð¾Ð² Ð²Ñ‹Ð²Ð¾Ð´Ð° ÑÑ‚Ñ€Ð¾
  32              	> .data
  32 0000 D092D0B2 	>  str0:.ascii "Ð’Ð²Ð¾Ð´Ð¸Ñ‚Ðµ Ñ†Ð¸Ñ„Ñ€Ñƒ, Ð´Ñ€ÑƒÐ³ Ð¼Ð¾Ð¹!\n"
  32      D0BED0B4 
  32      D0B8D182 
  32      D0B520D1 
  32      86D0B8D1 
  32              	>  strlen0 =. - str0
  32              	> 
  32              	> .text
  32 0002 B8040000 	>  movl $4,%eax
  32      00
  32 0007 BB010000 	>  movl $1,%ebx
  32      00
  32 000c B9000000 	>  movl $str0,%ecx
  32      00
  32 0011 BA2C0000 	>  movl $strlen0,%edx
  32      00
  32 0016 CD80     	>  int $0x80
GAS LISTING task3.S 			page 3


  33              						# Ñ„Ð°Ð¹Ð» stdout (Ð¿Ð¾Ð´ÑÐºÐ°Ð·ÐºÐ° Ð²Ð²Ð¾Ð´Ð°)
  34              	
  35              	kbd_input:
  36              	    Getchar $c          		# Ð¼Ð°ÐºÑ€Ð¾Ð²Ñ‹Ð·Ð¾Ð² Ð²Ð²Ð¾Ð´Ð° Ð±Ð°Ð¹Ñ‚Ð° Ð¸Ð· stdin Ð²
  36 0018 B8030000 	>  movl $3,%eax
  36      00
  36 001d BB000000 	>  movl $0,%ebx
  36      00
  36 0022 B9640000 	>  movl $c,%ecx
  36      00
  36              	>  
  36 0027 BA010000 	>  movl $1,%edx
  36      00
  36 002c CD80     	>  int $0x80
  37              						# Ð¿Ñ€Ð¾Ð¼ÐµÐ¶ÑƒÑ‚Ð¾Ñ‡Ð½Ñ‹Ð¹ Ð±ÑƒÑ„ÐµÑ€ c Ð´Ð»Ñ Ð°Ð½Ð°Ð»Ð¸Ð·Ð°
  38              	
  39 002e 83F800   	    cmpl $0, %eax     			# Ð½Ð°ÑÑ‚ÑƒÐ¿Ð¸Ð»Ð¾ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ðµ EOF (ÐºÐ¾Ð½ÐµÑ† Ñ„Ð°Ð¹Ð»Ð° stdin) ?
  40 0031 0F849000 	    je stop        			# Ð”Ð° - Ð½Ð° Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¸Ðµ Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ñ‹
  40      0000
  41              		
  42 0037 803D6400 	    cmpb $'\n', c     			# ÑÑ‚Ð¾ ÑÐ¸Ð¼Ð²Ð¾Ð» Ð¿ÐµÑ€ÐµÐ²Ð¾Ð´Ð° ÑÑ‚Ñ€Ð¾ÐºÐ¸ ?
  42      00000A
  43              	    // je kbd_input			# Ð”Ð - Ð½Ð° Ð²Ð²Ð¾Ð´ ÑÐ»ÐµÐ´ÑƒÑŽÑ‰ÐµÐ³Ð¾ ÑÐ¸Ð¼Ð²Ð¾Ð»Ð°
  44 003e 746E     	    je eax_input			# Ð”Ð - Ð½Ð° Ð²Ñ‹Ð²Ñ‹Ð¾Ð´ ÑÐ»ÐµÐ´ÑƒÑŽÑ‰ÐµÐ³Ð¾ Ð¿Ñ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰ÐµÐ³Ð¾ ÑÐ¸Ð¼Ð²Ð
  45 0040 803D6400 	    cmpb $'9', c      			# ÐºÐ¾Ð´ Ð±Ð¾Ð»ÑŒÑˆÐµ ÐºÐ¾Ð´Ð° ÑÐ¸Ð¼Ð²Ð¾Ð»Ð° '9' ?
  45      000039
  46 0047 7732     	    ja print_err_msg    		# Ð”Ð - Ð½Ð° Ð²Ñ‹Ð²Ð¾Ð´ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ Ð¾Ð± Ð¾ÑˆÐ¸Ð±ÐºÐµ
  47 0049 803D6400 	    cmpb $'0', c    			# ÐºÐ¾Ð´ Ð¼ÐµÐ½ÑŒÑˆÐµ ÐºÐ¾Ð´Ð° ÑÐ¸Ð¼Ð²Ð¾Ð»Ð° '0' ?
  47      000030
  48 0050 7229     	    jb print_err_msg    		# Ð”Ð - Ð½Ð° Ð²Ñ‹Ð²Ð¾Ð´ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ Ð¾Ð± Ð¾ÑˆÐ¸Ð±ÐºÐµ
  49              	
  50 0052 A0640000 	    movb c, %al         		# Ð¿ÐµÑ€ÐµÐ´Ð°Ñ‚ÑŒ ÐºÐ¾Ð´ ÑÐ¸Ð¼Ð²Ð¾Ð»Ð° Ñ†Ð¸Ñ„Ñ€Ñ‹ Ð¸Ð· c Ð² al
  50      00
  51 0057 83FE64   	    cmpl $100, %esi			# ÑÑ€Ð°Ð²Ð½Ð¸Ð²Ð°ÐµÐ¼ esi Ñ Ñ€Ð°Ð·Ð¼ÐµÑ€Ð¾Ð¼ Ð±ÑƒÑ„ÐµÑ€Ð°
  52 005a 743A     	    je print_end_msg			# Ð”Ð - Ð½Ð° Ð²Ñ‹Ð²Ð¾Ð´ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ Ð¾ Ð·Ð°Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ð¸ Ð±ÑƒÑ„Ðµ
  53 005c 88860000 	    movb %al, buf(%esi) 		# Ð¿ÐµÑ€ÐµÐ´Ð°Ñ‚ÑŒ ÐºÐ¾Ð´ ÑÐ¸Ð¼Ð²Ð¾Ð»Ð° Ñ†Ð¸Ñ„Ñ€Ñ‹ Ð¸Ð· al Ð² Ð±Ð°Ð¹Ñ‚
  53      0000
  54              						# Ð±ÑƒÑ„ÐµÑ€Ð° Ð¿Ð¾ Ð°Ð´Ñ€ÐµÑÑƒ &buf + esi
  55 0062 46       	    incl %esi       			# ÑƒÐºÐ°Ð·Ð°Ñ‚ÑŒ Ð½Ð° ÑÐ»ÐµÐ´ÑƒÑŽÑ‰Ð¸Ð¹ Ð±Ð°Ð¹Ñ‚ Ð±ÑƒÑ„ÐµÑ€Ð° Ð´Ð»Ñ
  56              						# ÑÐ»ÐµÐ´ÑƒÑŽÑ‰ÐµÐ³Ð¾ ÐºÐ¾Ð´Ð°
  57              	
  58              	    Puts "Ð¦Ð¸Ñ„Ñ€Ð°! Ð¥Ð¾Ñ€Ð¾ÑˆÐ¾." 		# ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ Ð¾Ð± ÑƒÑÐ¿ÐµÑ…Ðµ Ð²Ð²Ð¾Ð´Ðµ
  58              	> .data
  58 002c D0A6D0B8 	>  str2:.ascii "Ð¦Ð¸Ñ„Ñ€Ð°! Ð¥Ð¾Ñ€Ð¾ÑˆÐ¾.\n"
  58      D184D180 
  58      D0B02120 
  58      D0A5D0BE 
  58      D180D0BE 
  58              	>  strlen2 =. - str2
  58              	> 
  58              	> .text
  58 0063 B8040000 	>  movl $4,%eax
  58      00
  58 0068 BB010000 	>  movl $1,%ebx
  58      00
  58 006d B92C0000 	>  movl $str2,%ecx
  58      00
GAS LISTING task3.S 			page 4


  58 0072 BA1A0000 	>  movl $strlen2,%edx
  58      00
  58 0077 CD80     	>  int $0x80
  59              	
  60 0079 EB87     	    jmp show_prompt    			# Ð½Ð° Ð²Ð²Ð¾Ð´ ÑÐ»ÐµÐ´ÑƒÑŽÑ‰ÐµÐ³Ð¾ ÑÐ¸Ð¼Ð²Ð¾Ð»Ð°
  61              	
  62              	/*
  63              	 * ÐœÐ°ÐºÑ€Ð¾Ð²Ð²Ñ‹Ð·Ð¾Ð² Ð¸ Ð¼Ð°ÐºÑ€Ð¾Ñ€Ð°ÑÑˆÐ¸Ñ€ÐµÐ½Ð¸Ðµ Getchar
  64              	 * ÐŸÐ¾ÑÐ²Ð»ÐµÐ½Ð¸Ðµ Ð² Ð¸ÑÑ…Ð¾Ð´Ð½Ð¾Ð¼ Ñ„Ð°Ð¹Ð»Ðµ Ð¼Ð°ÐºÑ€Ð¾Ð²Ñ‹Ð·Ð¾Ð²Ð° Getchar $c Ð¿Ñ€Ð¸Ð²Ð¾Ð´
  65              	 * Ñ„Ð°Ð¹Ð» Ð¼Ð°ÐºÑ€Ð¾Ñ€Ð°ÑÑˆÐ¸Ñ€ÐµÐ½Ð¸Ñ ÐºÐ¾Ð¼Ð°Ð½Ð´ Ñ‚ÐµÐ»Ð° Ð¼Ð°ÐºÑ€Ð¾Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ñ, 
  66              	 * Ð¼Ð°ÐºÑ€Ð¾Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ñ buf_addr Ð·Ð°Ð¼ÐµÐ½Ñ‘Ð½ Ð½Ð° ÑƒÐºÐ°Ð·Ð°Ð½Ð½Ñ‹Ð¹ Ð² Ð¼Ð°ÐºÑ€Ð¾Ð²
  67              	 * $c, - Ð°Ð´Ñ€ÐµÑ Ð¾Ð´Ð½Ð¾Ð±Ð°Ð¹Ñ‚Ð¾Ð²Ð¾Ð³Ð¾ Ð±ÑƒÑ„ÐµÑ€Ð°, Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»Ñ‘Ð½Ð½Ð¾Ð³Ð¾ Ð² ÑÐµÐºÑ†
  68              	 * Ð—Ð°Ñ‚ÐµÐ¼ Ð´Ð»Ñ ÑÑ‚Ð¾Ð³Ð¾ Ð±ÑƒÑ„ÐµÑ€Ð° Ñ„Ð¾Ñ€Ð¼Ð¸Ñ€ÑƒÑŽÑ‚ÑÑ Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ñ‹Ðµ ÐºÐ¾Ð¼Ð°Ð½
  69              	*/
  70              	
  71              		
  72              	/*
  73              	 * ÐœÐ°ÐºÑ€Ð¾Ð²Ñ‹Ð·Ð¾Ð² Ð¸ Ð¼Ð°ÐºÑ€Ð¾Ñ€Ð°ÑÑˆÐ¸Ñ€ÐµÐ½Ð¸Ðµ Puts
  74              	 * ÐŸÐ¾ÑÐ²Ð»ÐµÐ½Ð¸Ðµ Ð² Ð¸ÑÑ…Ð¾Ð´Ð½Ð¾Ð¼ Ñ„Ð°Ð¹Ð»Ðµ Ð¼Ð°ÐºÑ€Ð¾Ð²Ñ‹Ð·Ð¾Ð²Ð° Puts "Ð¦Ð¸Ñ„Ñ€Ð°! Ð¥Ð¾Ñ
  75              	 * ÑÑ‚Ð¾Ñ‚ Ñ„Ð°Ð¹Ð» Ð¼Ð°ÐºÑ€Ð¾Ñ€Ð°ÑÑˆÐ¸Ñ€ÐµÐ½Ð¸Ñ (ÐºÐ¾Ð¼Ð°Ð½Ð´ Ñ‚ÐµÐ»Ð° Ð¼Ð°ÐºÑ€Ð¾Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»
  76              	 * Ð¼Ð°ÐºÑ€Ð¾Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ñ string Ð·Ð°Ð¼ÐµÐ½Ñ‘Ð½ Ð½Ð° ÑƒÐºÐ°Ð·Ð°Ð½Ð½Ñ‹Ð¹ Ð² Ð¼Ð°ÐºÑ€Ð¾Ð²Ñ‹
  77              	 * Ð¥Ð¾Ñ€Ð¾ÑˆÐ¾."
  78              	*/
  79              		
  80              	print_err_msg:
  81              	    Puts "ÐÐµ Ñ†Ð¸Ñ„Ñ€Ð¾Ð²Ð°Ñ ÐºÐ»Ð°Ð²Ð¸ÑˆÐ°. ÐŸÐ¾Ð²Ñ‚Ð¾Ñ€Ð¸Ñ‚Ðµ Ð²Ð²Ð¾Ð´"	# Ð²Ñ‹Ð²Ð¾Ð´ ÑÐ¾Ð¾Ð±Ñ
  81              	> .data
  81 0046 D09DD0B5 	>  str3:.ascii "ÐÐµ Ñ†Ð¸Ñ„Ñ€Ð¾Ð²Ð°Ñ ÐºÐ»Ð°Ð²Ð¸ÑˆÐ°. ÐŸÐ¾Ð²Ñ‚Ð¾Ñ€Ð¸Ñ‚Ðµ Ð²Ð²Ð¾Ð´\n"
  81      20D186D0 
  81      B8D184D1 
  81      80D0BED0 
  81      B2D0B0D1 
  81              	>  strlen3 =. - str3
  81              	> 
  81              	> .text
  81 007b B8040000 	>  movl $4,%eax
  81      00
  81 0080 BB010000 	>  movl $1,%ebx
  81      00
  81 0085 B9460000 	>  movl $str3,%ecx
  81      00
  81 008a BA420000 	>  movl $strlen3,%edx
  81      00
  81 008f CD80     	>  int $0x80
  82 0091 E96CFFFF 	    jmp show_prompt				# Ð½Ð° Ð²Ð²Ð¾Ð´ ÑÐ»ÐµÐ´ÑƒÑŽÑ‰ÐµÐ³Ð¾ ÑÐ¸Ð¼Ð²Ð¾Ð»Ð°
  82      FF
  83              	
  84              	print_end_msg:
  85              	    Puts "Ð‘ÑƒÑ„ÐµÑ€ Ð¿ÐµÑ€ÐµÐ¿Ð¾Ð»Ð½ÐµÐ½"			# Ð²Ñ‹Ð²Ð¾Ð´ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ Ð¾ Ð¿ÐµÑ€ÐµÐ¿Ð¾Ð»Ð½ÐµÐ
  85              	> .data
  85 0088 D091D183 	>  str4:.ascii "Ð‘ÑƒÑ„ÐµÑ€ Ð¿ÐµÑ€ÐµÐ¿Ð¾Ð»Ð½ÐµÐ½\n"
  85      D184D0B5 
  85      D18020D0 
  85      BFD0B5D1 
  85      80D0B5D0 
  85              	>  strlen4 =. - str4
  85              	> 
GAS LISTING task3.S 			page 5


  85              	> .text
  85 0096 B8040000 	>  movl $4,%eax
  85      00
  85 009b BB010000 	>  movl $1,%ebx
  85      00
  85 00a0 B9880000 	>  movl $str4,%ecx
  85      00
  85 00a5 BA200000 	>  movl $strlen4,%edx
  85      00
  85 00aa CD80     	>  int $0x80
  86 00ac EB19     	    jmp stop					# Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¸Ðµ Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ñ‹
  87              	
  88              	eax_input:
  89 00ae 89F3     	    movl %esi, %ebx			# ÐšÐ¾Ð¿Ð¸Ñ€ÑƒÐµÐ¼ %esi Ð² %ebx
  90 00b0 4B       	    decl %ebx 				# Ð£Ð¼ÐµÐ½ÑŒÑˆÐ°ÐµÐ¼ %ebx Ð½Ð° 1
  91 00b1 83FB00   	    cmpl $0, %ebx			# Ð¡Ñ€Ð°Ð²Ð½Ð¸Ð²Ð°ÐµÐ¼ %ebx c 0
  92 00b4 0F8C5EFF 	    jl kbd_input			# Ð”Ð - Ð¿ÐµÑ€ÐµÑ…Ð¾Ð´ Ðº Ð½Ð°Ñ‡Ð°Ð»Ñƒ Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ñ‹
  92      FFFF
  93              						# Ð½Ð° Ð²Ð²Ð¾Ð´ ÑÐ»ÐµÐ´ÑƒÑŽÑ‰ÐµÐ³Ð¾ ÑÐ¸Ð¼Ð²Ð¾Ð»Ð°
  94 00ba 8A830000 	    movb buf(%ebx), %al 		# ÐšÐ¾Ð¿Ð¸Ñ€ÑƒÐµÐ¼ ÑÑ‡ÐµÐ¹ÐºÑƒ buf + %ebx Ð² %al
  94      0000
  95 00c0 2C30     	    subb $'0', %al			# ÐžÑ‚Ð½Ð¸Ð¼Ð°ÐµÐ¼ 30 Ð¾Ñ‚ ÐºÐ¾Ð´Ð° ÑÐ¸Ð¼Ð²Ð¾Ð»Ð° Ð´Ð»Ñ Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ñ Ñ
  96              		 				# Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ñ
  97 00c2 E951FFFF 	    jmp kbd_input 			# ÐŸÐµÑ€ÐµÑ…Ð¾Ð´ Ðº Ð½Ð°Ñ‡Ð°Ð»Ñƒ Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ñ‹
  97      FF
  98              		
  99              	stop:
 100              	    Exit $0
 100 00c7 B8010000 	>  movl $1,%eax
 100      00
 100 00cc BB000000 	>  movl $0,%ebx
 100      00
 100 00d1 CD80     	>  int $0x80
 101              	
 102              	.end
GAS LISTING task3.S 			page 6


DEFINED SYMBOLS
             task3.S:14     .bss:0000000000000000 buf
             task3.S:14     .bss:0000000000000064 c
             task3.S:28     .text:0000000000000000 _start
             task3.S:31     .text:0000000000000002 show_prompt
             task3.S:32     .data:0000000000000000 str0
             task3.S:32     *ABS*:000000000000002c strlen0
             task3.S:35     .text:0000000000000018 kbd_input
             task3.S:99     .text:00000000000000c7 stop
             task3.S:88     .text:00000000000000ae eax_input
             task3.S:80     .text:000000000000007b print_err_msg
             task3.S:84     .text:0000000000000096 print_end_msg
             task3.S:58     .data:000000000000002c str2
             task3.S:58     *ABS*:000000000000001a strlen2
             task3.S:81     .data:0000000000000046 str3
             task3.S:81     *ABS*:0000000000000042 strlen3
             task3.S:85     .data:0000000000000088 str4
             task3.S:85     *ABS*:0000000000000020 strlen4

NO UNDEFINED SYMBOLS
